<html>
<head>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@500&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>

        .container {
            padding-top: 10vh;
            margin: auto;
            max-width: 700px;
            font-size: 2rem;
        }

        h1 {
            font-family: 'Caveat', cursive;
            font-weight: 400;
            margin: 0;
        }
        h2 {
            font-family: 'Roboto', sans-serif;
            font-weight: 300;
            font-size: 18px;
            color: gray;
        }
        strong {
            font-weight: 700;
        }

        textarea {
            width: 100%;
            padding: 25px;
            border: solid 3px;
        }
        input {
            width: 50%;
            padding: 25px;
            border: solid 3px;
            font-size: 13px;
        }

        input[type=text] {
            word-wrap: break-word;
            word-break: break-all;
            height: 80px;
            font-family: 'monospace';
        }

        #prediction-containter {
            position: relative;
            height: 100px;
        }

        .prediction {
            position: absolute;
            font-size: 13px;
            font-family: 'monospace';
            background-color: transparent;
            transition-timing-function: ease;
            transition-duration: 2s;
            transition-property: transform;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>
        My <strong>tech</strong> prediction for 2030
    </h1>
    <!-- todo: disallow multiline inputs: replace <enter> with action go to next field -->
    <h2>We are almost at the start of a next decade. Exciting isn't it?!
        To celebrate we are creating a <b>time capsule</b> filled with tech-related predictions for the upcoming decade.
        Let's all write down how we think technology will evolve, forget what we wrote, and open it in 2030.
        I'm sure you will have a blast looking back at how expectations line up with reality.</h2>
    <div id="prediction-containter" >
        <textarea id="prediction-input" placeholder="I predict..." class="wide" maxlength="256" rows="3" ></textarea>
    </div>
    <br/>
    <input id="author" type="text" placeholder="Optional: What's your name?" maxlength="56"/>
    <button id="send-button" >See ya in 30 years</button>
</div>

<!--Where do you think TECH lives in 2030?-->


<!--How do you think technology works in 2030?-->


<!--Time flies,-->
<!--Let's predict where to-->


<!--We can't predict the future-->
<!-- But let's do it anyway-->

<!-- Browser war -->

<script>
    const inputBoxPadding = 25;

    sendButton = document.getElementById('send-button');
    predictionContainer = document.getElementById('prediction-containter');
    predictionInput = document.getElementById('prediction-input');
    authorInput = document.getElementById('author');

    sendButton.addEventListener('click', () => {
        const prediction = predictionInput.value;
        const author = authorInput.value === "" ? null : authorInput.value;

        if(prediction === "") {
          alert("The prediction paper is still empty. I'm sure you can think of something that will change... Get inspired by the sample quotes in the background.")
          return;
        }

        fetch("/api", {
          method: "POST",
          body: JSON.stringify({prediction, author})
        }).then(res => {
            spawnPrediction(prediction, author)
        })
        .catch((err) => {
          console.log(err)
          alert("The prediction could not be added to the time capsule. Try again later.")
        });
    });

    function spawnPrediction(prediction, author) {
      const predictionElement = document.createElement("div");
      predictionElement.classList.add('prediction');
      predictionElement.style.maxWidth = predictionContainer.offsetWidth - 2*inputBoxPadding + "px";
      predictionElement.style.margin = `-${predictionInput.offsetHeight - inputBoxPadding} 0 0 ${inputBoxPadding}`;
      predictionElement.innerHTML = `"${prediction}"` + (author ? `<br/>&nbsp;- ${author}`: '');
      predictionContainer.insertBefore(predictionElement, predictionInput.nextSibling);
      predictionInput.value = '';

      requestAnimationFrame(() => {
        setTimeout(() => {
          const rect = predictionElement.getBoundingClientRect();

          const currx = rect.left + window.scrollX;
          const curry = rect.top + window.scrollY;

          const newx = Math.floor(Math.random() * (window.innerWidth - predictionElement.offsetWidth));
          const newy = Math.floor(Math.random() * (window.innerHeight - predictionElement.offsetHeight));

          predictionElement.style.transform = `translate(${newx - currx}px, ${newy - curry}px)`;
        }, 1);
      });
    }
</script>

</body>
</html>
